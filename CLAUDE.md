# ClipFlow Video - 開発ルール & ベストプラクティス

## 📁 プロジェクト情報

**プロジェクト名:** ClipFlow Video  
**Bundle ID:** com.tashichi.clipflow  
**開発環境:** Xcode + SwiftUI + AVFoundation + StoreKit  
**GitHubリポジトリ:** https://github.com/tashichi/JourneyMoments-MVP.git  
**プロジェクトパス:** `/Users/tanizawakenji/Desktop/JourneyMoments_v2/JourneyMoments/`

---

## 🎯 開発哲学

### 基本原則
1. **安定版を絶対に壊さない** - 動作する版を常に保持
2. **小さな変更の積み重ね** - 一度に1つの機能のみ実装
3. **実機テスト重視** - シミュレーターだけでなく実機で検証
4. **段階的実装・テスト** - 各ステップで確実に検証

### 避けるべきパターン
- ❌ 複数機能の同時実装（大量エラーの原因）
- ❌ 不完全な新API移行（既存動作版の破壊）
- ❌ 過度なUI変更（機能性を犠牲にした見た目追求）
- ❌ 完璧主義（永遠に公開できないアプリ化）

---

## 🤖 Claude Code サブエージェント活用ルール

### 基本ワークフロー（分散並列開発）
```
┌─────────────────────────────────────────┐
│         Phase開始（機能単位）            │
└──────────────┬──────────────────────────┘
               ↓
┌──────────────┴──────────────────────────┐
│    サブエージェント並列実行（最大3-4個）   │
├──────────────┬──────────────────────────┤
│ Agent 1:     │ Agent 2:                 │
│ UI実装       │ ロジック実装              │
│              │                          │
│ Agent 3:     │ Agent 4:                 │
│ データモデル │ テストコード作成          │
└──────────────┴──────────────────────────┘
               ↓
┌──────────────┴──────────────────────────┐
│           統合 & ビルド                  │
│  - コンパイル確認                        │
│  - 依存関係チェック                      │
│  - 初期動作確認                          │
└──────────────┬──────────────────────────┘
               ↓
┌──────────────┴──────────────────────────┐
│      Definition of Done (DoD) 確認      │
│  ✅ コンパイル成功                       │
│  ✅ シミュレーター動作確認                │
│  ✅ 実機テスト完了                       │
│  ✅ 既存機能の動作確認                   │
│  ✅ コードレビュー完了                   │
│  ✅ Gitコミット & プッシュ               │
└──────────────┬──────────────────────────┘
               ↓
┌──────────────┴──────────────────────────┐
│      プロダクションビルド & リリース      │
│  - Archive作成                           │
│  - TestFlightアップロード（必要時）      │
│  - タグ付け (例: v2.7-Feature-Name)     │
└──────────────┬──────────────────────────┘
               ↓
         Phase完了
```

---

## 📋 Definition of Done (DoD) チェックリスト

### 必須項目（Phase完了の条件）

#### 1. ビルド & コンパイル ✅
- [ ] Xcodeでビルド成功（⌘+B）
- [ ] 警告の確認（Critical警告はゼロ）
- [ ] エラーゼロ

#### 2. シミュレーターテスト ✅
- [ ] iPhone 15 Pro（最新機種）で起動確認
- [ ] 新機能の基本動作確認
- [ ] UI表示確認（レイアウト崩れなし）

#### 3. 実機テスト ✅
- [ ] 実機iPhone（iOS 18.6）で動作確認
- [ ] 新機能の完全動作確認
- [ ] カメラ・ライト等のハードウェア機能確認
- [ ] パフォーマンス確認（ラグなし）

#### 4. リグレッションテスト（既存機能の動作確認）✅
- [ ] プロジェクト作成・削除
- [ ] 1秒録画機能
- [ ] シームレス連続再生
- [ ] エクスポート機能
- [ ] フリーミアム制限（3プロジェクト、課金ボタン）
- [ ] ライト機能（該当する場合）

#### 5. コードレビュー ✅
- [ ] コードの可読性確認
- [ ] iOS版の設計パターン踏襲確認
- [ ] メモリリーク確認（onDisappear等のクリーンアップ）
- [ ] エラーハンドリング確認

#### 6. Git管理 ✅
- [ ] 意味のあるコミットメッセージ
- [ ] Gitコミット実行
- [ ] GitHubへプッシュ
- [ ] タグ付け（重要なマイルストーンの場合）

#### 7. ドキュメント更新 ✅
- [ ] README.md更新（機能追加の場合）
- [ ] CHANGELOG.md更新（バージョン管理）
- [ ] プロジェクトナレッジ更新

---

## 🚨 App Store申請トラブル事例

### 事例1: 「提出準備中」から進まない問題（2025年11月11日）

#### 症状
```
- バージョン1.1が「提出準備中」（🟡）から2日間進まない
- 「審査に提出」時にエラー：「審査用に追加できません - ビルドを選択してください」
- ビルド選択 → 保存 → 赤い！マークが表示される
```

#### 確認した項目（すべて正常）
```
✅ ビルド状態: 🟢 終了（Nov 9, 2025 9:05 AM）
✅ App内課金商品: 承認済み（com.tashichi.clipflow.fullversion）
✅ 商品とアプリの関連付け: 完了
✅ エクスポート準拠情報: 問題なし（非免除暗号化: いいえ）
✅ バイナリの状態: 確認済み
✅ TestFlightでの表示: 正常
```

#### 原因（推測）
```
Apple側の処理で何らかの内部エラーが発生し、
ビルドが「提出準備中」のまま固まっている可能性
```

#### 対応履歴
```
2025年11月11日: Apple調査依頼済み
待機中: Apple回答待ち
```

#### 解決策候補（Apple回答後に実施）
```
方法1: 新しいビルドをアップロード
1. Xcodeでビルド番号をインクリメント
   Version: 1.1（変更なし）
   Build: 1 → 2
2. Product → Archive
3. Upload to App Store Connect
4. 新ビルド「1.1 (2)」の処理完了を待つ
5. バージョン1.1に新ビルドを関連付け
6. 審査に提出

方法2: Apple指示に従う
- Apple Supportからの具体的な解決策を実施
```

#### 学習ポイント
```
- ビルドが24時間以上「提出準備中」の場合は異常
- すべての設定が正常でも、Apple側の処理エラーが発生する可能性がある
- 新しいビルドをアップロードすることで回避できる場合が多い
- 問題が複雑な場合は早めにApple Supportに問い合わせる
```

---

**作成日:** 2025年11月11日  
**最終更新:** 2025年11月11日  
**管理者:** tashichi（谷澤健二）  
**ステータス:** 運用中
